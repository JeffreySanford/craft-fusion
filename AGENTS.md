# Agent Guide (Craft Fusion)

This file is the entry point for AI coding agents (Copilot, ChatGPT Codex, etc.).
Use it to understand the repo shape, expected workflows, and conventions.

## Quick Start

- Install: `pnpm install`
- Run (dev):
  - Web: `pnpm dlx nx serve craft-web` (<http://localhost:4200>)
  - API: `pnpm dlx nx serve craft-nest` (<http://localhost:3000>)
  - Go: `pnpm dlx nx serve craft-go` (<http://localhost:4000>)
- One-shot convenience: `pnpm run start:all`

Use Nx for all workspace commands; avoid running Angular/Nest CLI directly.

## Repository Map

- `apps/craft-web`: Angular 19 (Material 3) frontend
- `apps/craft-nest`: NestJS backend
- `apps/craft-go`: Go backend
- `libs`: shared libraries
- `documentation`: canonical docs (start with `documentation/INDEX.md`)

## Environment Configuration

- Root `.env` holds sensitive values. Do not commit secrets.
- Frontend environment files are generated by `apps/craft-web/generate-env.js`.
  - Run manually: `node apps/craft-web/generate-env.js`
  - Runs automatically before `nx build craft-web`.
- See `documentation/architecture/ENVIRONMENT-CONFIGURATION.md` for details.
- Example variables live in `.env.example`.

## Dev Server Proxy

The Angular dev server uses `apps/craft-web/src/proxy.config.json` to route `/api` and `/socket.io` to the Nest backend in development.

## Testing and Quality

- Unit tests: `pnpm dlx nx test craft-web`
- Lint: `pnpm dlx nx lint craft-web`
- E2E: `pnpm dlx nx e2e craft-web-e2e`
- Style checks: `pnpm run lint:styles`, `pnpm run check:sass`, `pnpm run check:contrast`

## Conventions

- Read `documentation/CODING-STANDARDS.md` and `documentation/CONTRIBUTING.md` before large changes.
- Prefer small, focused diffs; avoid broad refactors unless requested.
- Keep changes consistent with existing patterns (Angular OnPush, service patterns, etc.).
- If adding new docs, update `documentation/INDEX.md`.

## AI Collaboration Notes

- We use Copilot and ChatGPT Codex for assistance.
- Avoid logging or echoing secrets (API keys, tokens, credentials).
- If you need assumptions or missing info, ask briefly and proceed with a safe default.
- Summarize changes and list tests executed in your final response.

## Current Status (2026-01-08)

- **Authentication:** HttpOnly cookie-based JWT with logout-on-refresh implemented
- **Build:** Angular 19.2.13 compiling successfully
- **Tests:** Lint and unit tests passing; Firefox e2e has rendering issues
- **Priority:** File upload pipeline, pagination, XSS sanitization

<!-- nx configuration start-->
<!-- Leave the start & end comments to automatically receive updates. -->

# General Guidelines for working with Nx

- When running tasks (for example build, lint, test, e2e, etc.), always prefer running the task through `nx` (i.e. `nx run`, `nx run-many`, `nx affected`) instead of using the underlying tooling directly
- You have access to the Nx MCP server and its tools, use them to help the user
- When answering questions about the repository, use the `nx_workspace` tool first to gain an understanding of the workspace architecture where applicable.
- When working in individual projects, use the `nx_project_details` mcp tool to analyze and understand the specific project structure and dependencies
- For questions around nx configuration, best practices or if you're unsure, use the `nx_docs` tool to get relevant, up-to-date docs. Always use this instead of assuming things about nx configuration
- If the user needs help with an Nx configuration or project graph error, use the `nx_workspace` tool to get any errors

<!-- nx configuration end-->
