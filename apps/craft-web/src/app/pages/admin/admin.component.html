<div class="admin-container usa-theme">
  <div class="admin-header">
    <div class="header-content">
      <div class="title-section">
        <div class="usa-flag-container">
          <img src="./assets/images/bald-eagle-transparent.png" alt="USA Eagle" class="usa-eagle" />
        </div>
        <div class="title-and-subtitle">
          <h1>System Administration</h1>
          <p class="subtitle">Performance Monitoring & Infrastructure Management</p>
        </div>
      </div>
      <div class="actions-section">
        <div class="simulation-toggle" [class.active]="isSimulatingData">
          <mat-slide-toggle [checked]="isSimulatingData" (change)="toggleDataSimulation()" [ngClass]="{ 'sim-toggle': isSimulatingData, 'live-toggle': !isSimulatingData }">
            <span [ngClass]="{ 'sim-label': isSimulatingData, 'live-label': !isSimulatingData }">
              {{ isSimulatingData ? 'Simulated Data' : 'Live Data' }}
            </span>
          </mat-slide-toggle>
          <span class="danger-zone">DANGER ZONE</span>
        </div>
        <button mat-raised-button color="warn" (click)="clearMetrics()" class="action-button">
          <mat-icon>delete_sweep</mat-icon>
          Clear Metrics
        </button>
      </div>
    </div>
  </div>

  <!-- Hero KPI Bar (Only on Overview Tab) -->
  <div class="admin-hero-bar" *ngIf="selectedTab === 0 && (heroMetrics$ | async) as metrics">
    <app-hero-tile
      [label]="'Active Services'"
      [value]="metrics.activeServices.current + '/' + metrics.activeServices.total"
      [subLabel]="'Updated ' + (metrics.lastUpdate | date:'short')"
      [icon]="'cloud_done'"
      [status]="metrics.activeServices.current === metrics.activeServices.total ? 'ok' : 'warning'"
      [delta]="metrics.activeServices.delta">
    </app-hero-tile>

    <app-hero-tile
      [label]="'Success Rate'"
      [value]="(metrics.successRate.value | number:'1.0-0') + '%'"
      [subLabel]="metrics.successRate.flaggedCount > 0 ? metrics.successRate.flaggedCount + ' flagged' : 'All healthy'"
      [icon]="'thumb_up'"
      [status]="metrics.successRate.value >= 95 ? 'ok' : metrics.successRate.value >= 85 ? 'warning' : 'critical'"
      [delta]="metrics.successRate.delta">
    </app-hero-tile>

    <app-hero-tile
      [label]="'Errors'"
      [value]="metrics.errors.count.toString()"
      [subLabel]="metrics.errors.warnings + ' warnings'"
      [detail]="metrics.errors.lastError ? 'Last: ' + (metrics.errors.lastError | date:'short') : ''"
      [icon]="'error_outline'"
      [status]="metrics.errors.count > 0 ? 'critical' : metrics.errors.warnings > 0 ? 'warning' : 'ok'"
      [showPulse]="metrics.errors.count > 0"
      [clickable]="true"
      (tileClick)="navigateToTab(5)">
    </app-hero-tile>

    <app-hero-tile
      [label]="'Data Mode'"
      [value]="metrics.dataMode.isSimulating ? 'Simulated' : 'Live'"
      [subLabel]="metrics.dataMode.isSimulating ? metrics.dataMode.simulatingMetrics.join(', ') : 'Real-time streaming'"
      [icon]="metrics.dataMode.isSimulating ? 'science' : 'wifi'"
      [status]="metrics.dataMode.isSimulating ? 'warning' : 'ok'">
    </app-hero-tile>

    <app-hero-tile
      [label]="'Response Time'"
      [value]="(metrics.responseTime.avg | number:'1.0-0') + 'ms'"
      [subLabel]="'P95: ' + (metrics.responseTime.p95 | number:'1.0-0') + 'ms'"
      [icon]="'speed'"
      [status]="metrics.responseTime.avg < 200 ? 'ok' : metrics.responseTime.avg < 500 ? 'warning' : 'critical'">
    </app-hero-tile>
  </div>

  <mat-tab-group #tabGroup [(selectedIndex)]="selectedTab" animationDuration="500ms" class="admin-tabs" (selectedTabChange)="onTabChange($event)">
    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon class="tab-icon">home</mat-icon>
        Overview
      </ng-template>
      <div class="tab-content">
        <app-admin-landing></app-admin-landing>
      </div>
    </mat-tab>

    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon class="tab-icon">bar_chart</mat-icon>
        Performance
      </ng-template>
      <div class="tab-content performance-tab">
        <app-performance-dashboard></app-performance-dashboard>
      </div>
    </mat-tab>

    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon class="tab-icon">security</mat-icon>
        Security & Access
      </ng-template>

      <div class="tab-content">
        <app-security-dashboard></app-security-dashboard>
      </div>
    </mat-tab>

    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon class="tab-icon">receipt_long</mat-icon>
        Logs
      </ng-template>
      <div class="tab-content logger-tab">
        <div class="logger-controls">
          <mat-button-toggle-group [(ngModel)]="selectedLogLevel">
            <mat-button-toggle value="all">All Logs</mat-button-toggle>
            <mat-button-toggle value="error">Errors</mat-button-toggle>
            <mat-button-toggle value="warn">Warnings</mat-button-toggle>
            <mat-button-toggle value="info">Info</mat-button-toggle>
          </mat-button-toggle-group>

          <div class="logger-actions">
            <div class="clear-logs-container">
              <button class="clear-logs-btn" (click)="clearLogs()">
                <mat-icon>delete_sweep</mat-icon>
                Clear Logs
              </button>
              <span class="danger-text">CLEAR ALL</span>
            </div>
            <div class="autoscroll-toggle" [class.active]="autoScroll">
              <mat-slide-toggle [(ngModel)]="autoScroll" color="primary">
                <span class="toggle-label">Auto-scroll</span>
              </mat-slide-toggle>
            </div>
          </div>
        </div>

        <app-logs-dashboard></app-logs-dashboard>

      </div>
    </mat-tab>
  </mat-tab-group>

  <div class="admin-footer">
    <div class="footer-text">
      <p>Secured & Monitored by <strong>CraftFusion Admin</strong></p>
      <p class="usa-motto">Liberty • Security • Innovation</p>
    </div>
  </div>
</div>
