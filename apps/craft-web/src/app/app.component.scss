/* Prevent horizontal overflow on html and body */
html, body {
  width: 100%;
  height: 100vh;
  overflow-x: hidden;
  overflow-y: hidden;
}

/* Root app container: full viewport, column layout */
.app-container {
  display: flex;
  flex-direction: column;
  height: 100vh;
  width: 100%; // Reset to 100%
  overflow: hidden;
  position: relative;
  box-sizing: border-box;
}

/* Header always at the top */
app-header {
  width: 100%;
  flex-shrink: 0;
  box-sizing: border-box;
}

/* Main layout: sidebar + main-stage in a flex row */
.layout-container {
  display: flex;
  flex-direction: row;
  flex: 1;
  width: 100%;
  min-width: 0;
  min-height: 0;
  align-items: stretch;
  box-sizing: border-box;
  column-gap: 0.25em;

  &.sidebar-collapsed {
    column-gap: 1em;
  }
}

/* Sidebar: fixed width, fits content height */
.sidebar {
  flex: 0 0 16em;
  display: flex;
  flex-direction: column;
  height: auto !important; // Allow it to shrink to its buttons
  align-self: flex-start; // Prevent it from stretching to full layout height
  box-sizing: border-box;
  transition: flex-basis 0.3s, width 0.3s;
  overflow-y: auto;
  overflow-x: hidden;
}

.sidebar.collapsed {
  flex-basis: 7em !important;
  width: 7em !important;
  min-width: 7em !important;
  max-width: 7em !important;
  padding: 0 !important;
  margin: 0 !important;
}

/* Main-stage: fills remaining space */
.main-stage {
  flex: 1;
  min-width: 0;
  min-height: 0;
  display: flex;
  flex-direction: column;
  background: transparent;
  box-sizing: border-box;
  transition: flex-basis 0.3s, width 0.3s;
  margin-right: 0.5em; // Reduced from 1.5em to match user preference
  margin-bottom: 0.5em; // 0.5em gutter from the footer
  overflow: hidden; // Contain children

  &.sidebar-collapsed {
    margin-right: 0.5em !important; // Maintain the 0.5em gutter even when collapsed
    margin-bottom: 0.5em !important; 
  }
}

.router-content-wrapper {
  flex: 1;
  display: flex;
  flex-direction: column;
  min-height: 0;
  width: 100%;
  overflow-y: auto; // Content scrollable here

  // Target the host component injected by router-outlet
  ::ng-deep > *:not(router-outlet) {
    display: flex !important;
    flex-direction: column !important;
    flex: 1 !important;
    min-height: 100% !important;
  }
}

/* Footer always at the bottom, styled like header */
app-footer {
  width: 100%;
  flex-shrink: 0;
  box-sizing: border-box;
}

#background-video {
  position: fixed;
  right: 0;
  bottom: 0;
  width: 100vw;
  height: 100vh;
  object-fit: cover;
  z-index: -1;
  opacity: 0.5;
  overflow: hidden;
  transform: scale(1.2);
}

// Define variables for clarity when footer is expanded.
// These can be defined on :root or a more specific common ancestor like .app-container.
:root {
  --footer-expanded-effective-height: 15em; /* This variable now represents the "size of the footer expanded height" you asked about. */
  --main-content-target-vh-when-footer-expanded: 70vh;
  --calculated-layout-height-footer-expanded: calc(var(--main-content-target-vh-when-footer-expanded) - var(--footer-expanded-effective-height));
}

// This rule provides a base lime border.
// The border for .layout-container.footer-expanded will be overridden by the more specific rule below.
.main-stage.footer-expanded,
.layout-container.footer-expanded, /* Will have its border overridden by the pink one below */
.router-content-wrapper.footer-expanded {
  max-height: calc(85vh - 15em) !important;
}

// Control the height of the layout-container when the footer is expanded.
// .main-stage and .router-content-wrapper will adjust their height automatically
// due to their `height: 100%` style, inheriting the new constrained height.
.layout-container.footer-expanded {
  height: var(--calculated-layout-height-footer-expanded) !important;
  max-height: var(--calculated-layout-height-footer-expanded) !important;
}
